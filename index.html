<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Comparison</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
</head>
<body>
  <h1>Сравнение игроков по форме</h1>

  <div>
    <h2>Игрок A</h2>
    <input type="text" id="playerA" value="0.6,0.7,0.8,0.5,0.9">
  </div>

  <div>
    <h2>Игрок B</h2>
    <input type="text" id="playerB" value="0.5,0.4,0.6,0.7,0.6">
  </div>

  <button onclick="predict()">Сравнить</button>

  <h3 id="result"></h3>

  <script>
    let model;

    // Создание модели
    function createModel() {
      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 16, inputShape: [20], activation: 'relu' }));
      model.add(tf.layers.dense({ units: 8, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 1, activation: 'sigmoid' }));
      model.compile({ optimizer: 'adam', loss: 'meanSquaredError' });
      return model;
    }

    // Генерация обучающих данных
    function generateTrainingData(numSamples = 50) {
      const xs = [];
      const ys = [];

      for (let i = 0; i < numSamples; i++) {
        const playerA = Array.from({ length: 10 }, () => Math.random());
        const playerB = Array.from({ length: 10 }, () => Math.random());
        const inputs = [...playerA, ...playerB];

        const scoreA = playerA.reduce((a, b) => a + b, 0);
        const scoreB = playerB.reduce((a, b) => a + b, 0);
        const output = scoreA / (scoreA + scoreB); // Пропорция, кто сильнее

        xs.push(inputs);
        ys.push([output]);
      }

      return {
        xs: tf.tensor2d(xs),
        ys: tf.tensor2d(ys)
      };
    }

    // Обучение модели
    async function initModel() {
      model = createModel();
      const { xs, ys } = generateTrainingData(50); // Быстрое обучение

      await model.fit(xs, ys, {
        epochs: 10,
        batchSize: 10,
        validationSplit: 0.2,
        callbacks: {
          onEpochEnd: (epoch, logs) => {
            console.log(`Epoch ${epoch + 1}: loss = ${logs.loss.toFixed(4)}`);
          }
        }
      });

      xs.dispose();
      ys.dispose();
    }

    // Предсказание
    async function predict() {
      if (!model) {
        document.getElementById("result").textContent = "Обучение...";
        await initModel();
      }

      const inputA = document.getElementById("playerA").value.split(",").map(Number);
      const inputB = document.getElementById("playerB").value.split(",").map(Number);

      if (inputA.length !== 5 || inputB.length !== 5) {
        document.getElementById("result").textContent = "Введите по 5 чисел для каждого игрока.";
        return;
      }

      // Дополняем до 10, чтобы у модели было 10 фич на игрока
      const paddedA = [...inputA, ...Array(10 - inputA.length).fill(0)];
      const paddedB = [...inputB, ...Array(10 - inputB.length).fill(0)];
      const input = tf.tensor2d([paddedA.concat(paddedB)]);

      const prediction = model.predict(input);
      const result = (await prediction.data())[0];
      input.dispose();
      prediction.dispose();

      const percent = (result * 100).toFixed(2);
      document.getElementById("result").textContent = `Шанс игрока A выиграть: ${percent}%`;
    }
  </script>
</body>
</html>
