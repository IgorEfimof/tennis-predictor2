<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Прогноз теннисного матча</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .game-input {
      margin: 10px 0;
      display: flex;
      gap: 10px;
    }
    input {
      width: 80px;
      padding: 5px;
    }
    button {
      padding: 10px 15px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 5px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Прогноз теннисного матча</h1>
  <p>Введите коэффициенты для каждого игрока (от 1.0 до 5.0)</p>
  
  <div id="games-container"></div>
  
  <button id="predict-btn">Прогнозировать</button>
  
  <div id="result" class="hidden">
    <h3>Результат:</h3>
    <p>Вероятность победы Игрока A: <span id="prob-a"></span>%</p>
    <p>Вероятность победы Игрока B: <span id="prob-b"></span>%</p>
    <p><strong>Прогноз:</strong> <span id="winner"></span></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Проверяем загрузку TensorFlow.js
      if (!tf) {
        alert('TensorFlow.js не загружен. Проверьте интернет-соединение.');
        return;
      }

      // Создаем поля для ввода
      const gamesContainer = document.getElementById('games-container');
      for (let i = 1; i <= 5; i++) {
        const div = document.createElement('div');
        div.className = 'game-input';
        div.innerHTML = `
          <span>Гейм ${i}:</span>
          <input type="number" id="game-${i}-a" placeholder="A" min="1" max="5" step="0.01">
          <input type="number" id="game-${i}-b" placeholder="B" min="1" max="5" step="0.01">
        `;
        gamesContainer.appendChild(div);
      }

      // Создаем простую модель
      const createModel = () => {
        const model = tf.sequential();
        model.add(tf.layers.dense({
          inputShape: [5],
          units: 8,
          activation: 'relu'
        }));
        model.add(tf.layers.dense({
          units: 1,
          activation: 'sigmoid'
        }));
        model.compile({
          optimizer: 'adam',
          loss: 'binaryCrossentropy'
        });
        return model;
      };

      // Генерируем простые тренировочные данные
      const generateTrainingData = () => {
        const xs = [];
        const ys = [];
        
        for (let i = 0; i < 100; i++) {
          // Игрок A фаворит
          if (i % 3 === 0) {
            xs.push([1.2 + Math.random()*0.3, 1.3 + Math.random()*0.3, 
                    1.1 + Math.random()*0.3, 1.4 + Math.random()*0.3, 
                    1.2 + Math.random()*0.3]);
            ys.push(1);
          } 
          // Игрок B фаворит
          else if (i % 3 === 1) {
            xs.push([2.5 + Math.random()*0.5, 2.3 + Math.random()*0.5, 
                    2.6 + Math.random()*0.5, 2.4 + Math.random()*0.5, 
                    2.5 + Math.random()*0.5]);
            ys.push(0);
          }
          // Равные шансы
          else {
            xs.push([1.8 + Math.random()*0.4, 1.7 + Math.random()*0.4, 
                    1.9 + Math.random()*0.4, 1.8 + Math.random()*0.4, 
                    1.7 + Math.random()*0.4]);
            ys.push(0.5);
          }
        }
        
        return {
          xs: tf.tensor2d(xs),
          ys: tf.tensor1d(ys)
        };
      };

      // Инициализация модели
      const model = createModel();
      const trainingData = generateTrainingData();
      
      // Быстрое обучение (5 эпох)
      await model.fit(trainingData.xs, trainingData.ys, {
        epochs: 5,
        batchSize: 10,
        verbose: 0
      });
      
      // Очищаем память
      tf.dispose([trainingData.xs, trainingData.ys]);

      // Обработчик кнопки прогноза
      document.getElementById('predict-btn').addEventListener('click', async () => {
        try {
          // Собираем данные
          const playerA = [];
          const playerB = [];
          
          for (let i = 1; i <= 5; i++) {
            const a = parseFloat(document.getElementById(`game-${i}-a`).value);
            const b = parseFloat(document.getElementById(`game-${i}-b`).value);
            
            if (isNaN(a) || isNaN(b) || a < 1 || a > 5 || b < 1 || b > 5) {
              alert(`Пожалуйста, введите корректные значения для Гейма ${i} (от 1.0 до 5.0)`);
              return;
            }
            
            playerA.push(a);
            playerB.push(b);
          }
          
          // Нормализуем данные (чем меньше коэффициент, тем выше вероятность)
          const normalize = (coeffs) => coeffs.map(x => (5.0 - x) / 4.0);
          
          // Делаем предсказание
          const inputA = tf.tensor2d([normalize(playerA)]);
          const inputB = tf.tensor2d([normalize(playerB)]);
          
          const probA = (await model.predict(inputA).data())[0] * 100;
          const probB = (await model.predict(inputB).data())[0] * 100;
          
          // Очищаем память
          tf.dispose([inputA, inputB]);
          
          // Показываем результат
          document.getElementById('prob-a').textContent = probA.toFixed(1);
          document.getElementById('prob-b').textContent = probB.toFixed(1);
          document.getElementById('winner').textContent = 
            probA > probB ? 'Игрок A' : 'Игрок B';
          document.getElementById('result').classList.remove('hidden');
          
        } catch (error) {
          console.error('Ошибка:', error);
          alert('Произошла ошибка при расчетах. Пожалуйста, проверьте введенные данные.');
        }
      });
    });
  </script>
</body>
</html>
